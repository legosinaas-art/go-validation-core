# validation-core

Сервис для выдачи и проверки цифровых ID. Написан на Go, использует JWT токены и QR-коды.

## Что это

Проект для выдачи цифровых пропусков. Выдаешь токен с QR-кодом, потом можно проверить его валидность через веб-интерфейс или API. Токены подписываются JWT, хранятся пока что в памяти.

## Технологии

- Go 1.25
- Gin для HTTP роутинга
- JWT для токенов
- QR-коды через библиотеку go-qrcode

## Структура

```
cmd/              - точка входа и сервер
configs/          - конфигурация через .env
internal/
  domain/         - модели данных
  http/           - хендлеры и роутер
  repository/     - хранение токенов (in-memory)
  service/        - бизнес-логика
framework/        - утилиты
templates/        - HTML шаблоны
```

## Установка

Клонируешь репозиторий, потом:

```bash
go mod tidy
```

Создаешь файл `.env` в корне (опционально):

```env
PORT=8080
JWT_SECRET=твой-секретный-ключ
TEMPLATES_DIR=templates
```

Если `.env` нет, то используются дефолтные значения (порт 8080, секрет "secretKey").

## Запуск

Для разработки:
```bash
go run ./cmd
```

Или собрать бинарник:
```bash
go build -o validation-core.exe ./cmd
```

Сервер запустится на `http://localhost:8080` (или на порту из переменной PORT).

## API

### Веб-интерфейс

- `GET /` - форма для проверки токена
- `GET /check/result?token=...` - результат проверки
- `GET /issue` - форма для выдачи нового ID
- `POST /issue/process` - обработка формы выдачи

### JSON API

**Проверка токена:**
```
GET /api/validate?token=eyJhbGc...
```

Ответ:
```json
{
  "is_valid": true,
  "message": "ДОКУМЕНТ ПОДЛИННЫЙ. Доступ разрешен.",
  "name": "Иванов Иван",
  "expires_at": "02 Jan 06 15:04 MST"
}
```

**Выдача ID:**
```
POST /api/issue
Content-Type: application/json

{
  "passport_id": "1234567890",
  "full_name": "Иванов Иван Иванович"
}
```

Ответ:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_at": "02 Jan 06 15:04 MST",
  "qr_code_image_url": "/api/qr/1234567890"
}
```

**Получение QR-кода:**
```
GET /api/qr/:passportID
```

Возвращает PNG изображение QR-кода.

## Как работает

1. Пользователь отправляет паспортные данные (через форму или API)
2. Сервис проверяет паспорт через `CheckGos` (сейчас это просто мок, возвращает false только для паспорта "0000")
3. Если все ок, генерируется JWT токен со сроком действия 30 дней
4. Создается QR-код с этим токеном
5. Все сохраняется в памяти (при перезапуске сервера данные теряются)

При проверке токена:
- Проверяется подпись JWT
- Проверяется срок действия
- Повторно проверяется статус через `CheckGos`
- Возвращается результат




